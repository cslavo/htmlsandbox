<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Webkamery Žilina</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; }
        textarea { width: 100%; height: 200px; margin-bottom: 20px; }
        button { padding: 10px 20px; margin-right: 10px; }
        #cameras, .group-content { display: flex; flex-wrap: wrap; }
        .camera { margin: 10px; text-align: center; width: 300px; }
        .camera img { max-width: 100%; height: auto; cursor: pointer; }
        #modal { display: none; position: fixed; z-index: 1; left: 0; top: 0; width: 100%; height: 100%; overflow: hidden; background-color: rgba(0,0,0,0.9); }
        #modalImgContainer { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); }
        #modalImg { max-width: none; max-height: none; }
        .close { position: absolute; top: 15px; right: 35px; color: #f1f1f1; font-size: 40px; font-weight: bold; cursor: pointer; }
        .imageInfo { color: white; text-align: center; padding: 10px 0; position: absolute; bottom: 20px; width: 100%; }
        #zoomControls { position: absolute; top: 20px; left: 20px; }
        #zoomControls button { margin-right: 10px; }
        .group { margin-bottom: 20px; border: 1px solid #ccc; padding: 10px; }
        .group-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px; }
        .group-header h3 { margin: 0; }
        .toggle-group, .delete-group, .reorder-group { cursor: pointer; }
        .camera-order { width: 40px; margin-right: 5px; display: none; }
    </style>
</head>
<body>
    <h1>Webkamery Žilina</h1>
    <textarea id="sourceCode" placeholder="Vložte sem zdrojový kód stránky..." onclick="this.select()"></textarea>
    <button onclick="processCode()">Spracovať kód</button>
    <button id="groupBtn" onclick="groupSelected()" disabled>Zoskupiť</button>
    <div id="groups"></div>
    <div id="cameras"></div>

    <div id="modal">
        <span class="close">&times;</span>
        <div id="zoomControls">
            <button onclick="zoomIn()">+</button>
            <button onclick="zoomOut()">-</button>
        </div>
        <div id="modalImgContainer">
            <img id="modalImg">
        </div>
        <div class="imageInfo"></div>
    </div>

    <script>
    let currentZoom = 1;
    let isDragging = false;
    let startX, startY, translateX = 0, translateY = 0;
    let cameras = {};

    function processCode() {
        var sourceCode = $('#sourceCode').val();
        var regex = /<center><b>(.*?)<\/b><\/center>\s*<img src="(.*?)"/g;
        cameras = {};
        var match;

        while ((match = regex.exec(sourceCode)) !== null) {
            var name = match[1];
            var url = match[2];
            
            if (!cameras[name]) {
                cameras[name] = [];
            }
            cameras[name].push(url);
        }

        var sortedCameras = Object.keys(cameras).sort().reduce((acc, key) => {
            acc[key] = cameras[key];
            return acc;
        }, {});

        displayCameras(sortedCameras);
    }

    function displayCameras(cameras) {
        var html = '';
        for (var name in cameras) {
            cameras[name].forEach(function(url, index) {
                var currentTime = new Date().toLocaleTimeString('sk-SK', { hour12: false });
                var id = name.replace(/\s+/g, '_') + '_' + index;
                html += '<div class="camera" data-name="' + name + '" data-index="' + index + '">';
                html += '<div style="display: flex; align-items: center; justify-content: center;">';
                html += '<input type="checkbox" id="' + id + '" onchange="updateGroupBtn()">';
                html += '<input type="number" class="camera-order" value="' + (index + 1) + '" min="1">';
                html += '<h3>' + name + (cameras[name].length > 1 ? ' (' + (index + 1) + ')' : '') + '</h3>';
                html += '</div>';
                html += '<p>Čas: ' + currentTime + '</p>';
                html += '<img src="' + url + '?t=' + new Date().getTime() + '" alt="' + name + '" onclick="openModal(this.src, this.alt, \'' + currentTime + '\')">';
                html += '</div>';
            });
        }
        $('#cameras').html(html);
    }

    function updateGroupBtn() {
        $('#groupBtn').prop('disabled', $('input[type=checkbox]:checked').length === 0);
    }

    function groupSelected() {
        var groupName = prompt("Zadajte názov skupiny:");
        if (groupName) {
            var existingGroup = $('#groups').find('h3:contains("' + groupName + '")').closest('.group');
            if (existingGroup.length) {
                // Add to existing group
                var groupContent = existingGroup.find('.group-content');
                $('input[type=checkbox]:checked').each(function() {
                    var camera = $(this).closest('.camera');
                    groupContent.append(camera);
                    $(this).prop('checked', false);
                    camera.find('.camera-order').show();
                });
            } else {
                // Create new group
                var groupId = 'group_' + Date.now();
                var groupHtml = '<div class="group" id="' + groupId + '">';
                groupHtml += '<div class="group-header">';
                groupHtml += '<h3>' + groupName + '</h3>';
                groupHtml += '<div>';
                groupHtml += '<button class="toggle-group" onclick="toggleGroup(\'' + groupId + '\')">Zbaliť/Rozbaliť</button>';
                groupHtml += '<button class="delete-group" onclick="deleteGroup(\'' + groupId + '\')">Zrušiť skupinu</button>';
                groupHtml += '<button class="reorder-group" onclick="reorderGroup(\'' + groupId + '\')">Preskupiť</button>';
                groupHtml += '</div>';
                groupHtml += '</div>';
                groupHtml += '<div class="group-content">';
                $('input[type=checkbox]:checked').each(function() {
                    var camera = $(this).closest('.camera');
                    groupHtml += camera.prop('outerHTML');
                    camera.remove();
                });
                groupHtml += '</div></div>';
                $('#groups').append(groupHtml);
                $('#' + groupId + ' .camera-order').show();
                $('#' + groupId + ' input[type=checkbox]').prop('checked', false);
            }
            updateGroupBtn();
        }
    }

    function toggleGroup(groupId) {
        $('#' + groupId + ' .group-content').toggle();
    }

    function deleteGroup(groupId) {
        var cameras = $('#' + groupId + ' .camera');
        cameras.find('.camera-order').hide();
        $('#cameras').append(cameras);
        $('#' + groupId).remove();
    }

    function reorderGroup(groupId) {
        var cameras = $('#' + groupId + ' .camera').get();
        cameras.sort(function(a, b) {
            var orderA = parseInt($(a).find('.camera-order').val()) || 0;
            var orderB = parseInt($(b).find('.camera-order').val()) || 0;
            return orderA - orderB;
        });
        $('#' + groupId + ' .group-content').empty().append(cameras);
    }

    function openModal(src, alt, time) {
        $('#modal').css('display', 'flex');
        $('#modalImg').attr('src', src).attr('alt', alt);
        $('.imageInfo').text(alt + ' - Čas: ' + time);
        currentZoom = 1;
        translateX = 0;
        translateY = 0;
        updateTransform();
    }

    function zoomIn() {
        currentZoom *= 1.2;
        updateTransform();
    }

    function zoomOut() {
        currentZoom /= 1.2;
        updateTransform();
    }

    function updateTransform() {
        $('#modalImg').css('transform', `translate(${translateX}px, ${translateY}px) scale(${currentZoom})`);
    }

    $('.close').click(function() {
        $('#modal').hide();
    });

    $(window).click(function(event) {
        if (event.target == document.getElementById('modal')) {
            $('#modal').hide();
        }
    });

    $(document).keydown(function(event) {
        if (event.key === "Escape") {
            $('#modal').hide();
        }
    });

    $('#modalImg').mousedown(function(e) {
        isDragging = true;
        startX = e.clientX - translateX;
        startY = e.clientY - translateY;
    });

    $(document).mousemove(function(e) {
        if (isDragging) {
            translateX = e.clientX - startX;
            translateY = e.clientY - startY;
            updateTransform();
        }
    });

    $(document).mouseup(function() {
        isDragging = false;
    });

    $('#modalImgContainer').on('wheel', function(e) {
        e.preventDefault();
        let delta = e.originalEvent.deltaY;
        if (delta > 0) {
            zoomOut();
        } else {
            zoomIn();
        }
    });
    </script>
</body>
</html>